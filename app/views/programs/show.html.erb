<div class='row'>
  <div class='col-md-12'>
    <%= render :partial => 'programs/state_bar' %>
  </div>
</div>
<% if @program.can_create? %>
    <% if @program.can_announce? && @program.state == ::Program::STATE_PROPOSED %>
        <div class='alert alert-success'>
          <br>
          <strong>This program is ready for announcement.</strong>
        </div>
    <% elsif !@program.is_announced? && @program.is_active? %>
        <div class='alert alert-danger'>
          This program is not yet ready for announcement.
          <small><%= link_to "[Why?]", '#', :id => 'prog-why-a' %></small>
        </div>
        <div class='row' id='program-announcement-overview' style='display :none;'>
          <div class='col-md-12'>
            <table class='table table-bordered'>
              <tr>
                <td width='25%'><strong>Venue Status</strong></td>
                <td>
                  <% if @program.no_of_venues_connected > 0 %>
                    <%= (@program.venue_schedules.map {|vs| "#{vs.venue[:name]} => #{vs[:state]}" if vs.is_connected?}).join(", ") %>
                  <% else %>
                    No Venue Attached.
                  <% end %>
                </td>
              </tr>
              <tr>
                <td><strong>Kit Status</strong></td>
                <td>
                  <% if @program.no_of_kits_connected > 0 %>
                    <%= (@program.kit_schedules.map {|ks| "#{ks.kit[:name]} => #{ks[:state]}" if ks.is_connected?}).join(", ") %>
                  <% else %>
                      No Kit Attached.
                  <% end %>
                </td>
              </tr>
              <tr>
                <td><strong>Teacher Status</strong></td>
                <td>
                  Teacher Required: <%= @program.minimum_no_of_teacher %> <br/>
                  Teacher Associated: <%= @program.no_of_teachers_connected %>
                </td>
              </tr>
            </table>
          </div>
        </div>
    <% end %>
<% end %>
<% if @program.can_update? %>
<div class='row'>
  <div class='col-md-12'>
    <h3>Last Update <small><%= @program.last_update %></small></h3>
    <div class = 'row'>
      <div class='col-md-12'>
        <table class='table table-bordered'>
          <tr>
            <td width='20%'><strong> Updated By </strong></td>
            <td>
                <%= @program.last_updated_by_user.fullname rescue ' ' %>
            </td>
          </tr>
          <tr>
            <td><strong> Updated At </strong></td>
            <td><%= @program.last_updated_at.strftime('%d %B %Y (%I:%M%P)') rescue ' ' %></td>
          </tr>
          <tr>
            <td><strong> Comments </strong></td>
            <td><%= @program.comments %></td>
          </tr>
          <% unless @program.feedback.nil? %>
              <tr>
                <td><strong> Feedback </strong></td>
                <td><%= @program.feedback %></td>
              </tr>
          <% end %>
        </table>
      </div>
    </div>
  </div>
</div>
<% end %>
<div class='row'>
  <h3>Basic Details</h3>
  <div class='col-md-12'>
    <table class='table table-bordered'>
      <tr>
        <td width='20%'><strong>Internal Id</strong></td>
        <td><%= @program.id %></td>
      </tr>
      <tr>
        <td><strong>Announced Program Id</strong></td>
        <td><%= @program.announce_program_id %></td>
      </tr>
      <tr>
        <td><strong> Name </strong></td>
        <td><%= @program.name %></td>
      </tr>
      <tr>
        <td width='20%'><strong>Center</strong></td>
        <td><%= @program.center.name %></td>
      </tr>
      <tr>
        <td><strong>Proposed By</strong></td>
        <td><%= @program.proposer.fullname %></td>
      </tr>
      <tr>
        <td><strong>Start Date</strong></td>
        <td><%= @program.start_date.strftime('%d %B %Y (%A)') %></td>
      </tr>
      <tr>
        <td><strong>End Date</strong></td>
        <td><%= @program.end_date.strftime('%d %B %Y (%A)') %></td>
      </tr>
      <tr>
        <td><strong>Timing (s)</strong></td>
        <td><%= (@program.timings.map {|c| c[:name]}).join(", ") %></td>
      </tr>
    </table>
  </div>
</div>


  <div class='row'>
    <div class='page-header'>
      <h3>
        Venue Details
      </h3>
    </div>
  </div>

  <div class='row'>
  <div class='col-md-12'>
    <% if @program.no_of_venues_connected > 0 %>
        <% @program.venue_schedules.each do |vs| %>
            <%  vs.current_user = current_user %>
            <% if vs.is_connected? %>
                <div class='alert alert-success'>
                  <% if vs.can_update? %>
                    Venue  <%= link_to "#{vs.venue.name}", venue_schedule_path(vs) %> is currently linked to the program.
                  <% else %>
                      Venue  <%= link_to "#{vs.venue.name}", venue_path(vs.venue) %> is currently linked to the program.
                  <% end %>
                </div>
            <% else %>
                <div class='alert alert-danger'>
                  <% if vs.can_update? %>
                      Venue  <%= link_to "#{vs.venue.name}", venue_schedule_path(vs) %> was earlier linked to the program.
                  <% else %>
                      Venue  <%= link_to "#{vs.venue.name}", venue_path(vs.venue) %> was earlier linked to the program.
                  <% end %>
                </div>
            <% end %>
        <% end %>
    <% else %>
    <div class='alert alert-danger'>
      No Venue is associated with this program.
    </div>
    <% end %>
  </div>
</div>

<div class='row'>
  <div class='page-header'>
    <h3>
      Kit Details
    </h3>
  </div>
</div>
<div class='row'>
  <div class='col-md-12'>
    <% if @program.no_of_kits_connected > 0 %>
        <% @program.kit_schedules.each do |ks| %>
            <%  ks.current_user = current_user %>
            <% if ks.is_connected? %>
                <div class='alert alert-success'>
                  <% if ks.can_update? %>
                      Kit  <%= link_to "#{ks.kit.name}", kit_schedule_path(ks) %> is currently linked to the program.
                  <% else %>
                      Kit  <%= link_to "#{ks.kit.name}", kit_path(ks.kit) %> is currently linked to the program.
                  <% end %>
                </div>
            <% else %>
                <div class='alert alert-danger'>
                  <% if ks.can_update? %>
                  Kit  <%= link_to "#{ks.kit.name}", kit_schedule_path(ks) %> was earlier linked to the program.
                  <% else %>
                      Kit  <%= link_to "#{ks.kit.name}", kit_path(ks.kit) %> was earlier linked to the program.
                  <% end %>
                </div>
            <% end %>
        <% end %>
    <% else %>
    <div class='alert alert-danger'>
      No Kit is associated with this program.
    </div>
    <% end %>
  </div>
</div>

<div class='row'>
  <div class='page-header'>
    <h3>
      Teacher Details
    </h3>
  </div>
</div>
<div class='row'>
  <div class='col-md-12'>
    <% if @program.no_of_teachers_connected_or_conducted > 0 %>
      <% @program.teachers_connected.each do |ts| %>
          <%  ts.current_user = current_user %>
          <div class='alert alert-success'>
            <% if ts.can_view_schedule? %>
                Teacher  <%= link_to "#{ts.teacher.user.fullname}", program_teacher_schedule_path(:id => ts.id) %> is currently linked to the program.
            <% else %>
                Teacher  <%= link_to "#{ts.teacher.user.fullname}", teacher_path(ts.teacher) %> is currently linked to the program.
            <% end %>
          </div>
      <% end %>
      <% @program.teachers_conducted_class.each  do |ts| %>
        <%  ts.current_user = current_user %>
        <div class='alert alert-success'>
          <% if ts.can_view_schedule? %>
              Teacher  <%= link_to "#{ts.teacher.user.fullname}", program_teacher_schedule_path(:id => ts.id) %> conducted the program.
          <% else %>
              Teacher  <%= link_to "#{ts.teacher.user.fullname}", teacher_path(ts.teacher) %> conducted the program.
          <% end %>
        </div>
      <% end %>
  <% else %>
    <div class='alert alert-danger'>
      No Teacher is associated with this program.
    </div>
    <% end %>
  </div>
</div>

<script type='text/javascript'>
  $('#prog-why-a').click(function() {
    $('#program-announcement-overview').toggle();
    return false;
  });
</script>